<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 200vh; /* On crée du scroll dans la page */
        background: white;
      }

      .machine1-container {
        position: sticky;
        top: 0;
        height: 100vh;
        background: transparent;
      }

      .sequence-wrapper {
        width: 50%;
        height: 50%;
        overflow: hidden;
        position: relative;
      }

      #sequence {
        width: 100%;
        height: 100%;
        display: block;
        background: transparent;
      }
    </style>
  </head>

  <body>
    <section class="machine1-container">
      <div class="sequence-wrapper">
        <canvas id="sequence"></canvas>
      </div>
    </section>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const canvas = document.getElementById("sequence");
        const ctx = canvas.getContext("2d");

        const frameCount = 100; // nombre d'images
        const currentFrame = (index) =>
          `https://raw.githubusercontent.com/sitebobines/sequence-images/main/fils/${String(index + 1).padStart(4, "0")}.png`;

        const images = [];
        let loaded = 0;
        let imgIndex = 0;

        // Canvas responsive
        function resizeCanvas() {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
          drawFrame(imgIndex);
        }
        window.addEventListener("resize", resizeCanvas);
        resizeCanvas();

        // Préchargement des images
        for (let i = 0; i < frameCount; i++) {
          const img = new Image();
          img.src = currentFrame(i);
          img.onload = () => {
            loaded++;
            if (loaded === 1) drawFrame(0);
          };
          images.push(img);
        }

        // Fonction d'affichage d'une frame
        function drawFrame(index) {
          const img = images[index];
          if (!img || !img.complete) return;
          const scale = Math.min(
            canvas.width / img.width,
            canvas.height / img.height
          );
          const x = (canvas.width - img.width * scale) / 2;
          const y = (canvas.height - img.height * scale) / 2;
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
        }

        // --- Scroll fluide ---
        let targetFrame = 0;
        let currentFrameIndex = 0;

        function animate() {
          currentFrameIndex += (targetFrame - currentFrameIndex) * 0.1;
          drawFrame(Math.round(currentFrameIndex));
          requestAnimationFrame(animate);
        }
        animate();

        // Calcul du scroll sur la page
        window.addEventListener("scroll", () => {
          const scrollTop = window.scrollY;
          const maxScroll = document.body.scrollHeight - window.innerHeight;
          const scrollFraction = scrollTop / maxScroll;
          targetFrame = Math.min(
            frameCount - 1,
            Math.floor(scrollFraction * frameCount)
          );
        });
      });
    </script>
  </body>
</html>
